{# Shared latency UI: toggle + KPI cards + detailed tables.
   Expects Alpine state from dashboard.js:
   - latencyView: 'end_to_end' | 'sf_execution'
   - setLatencyView(view)
   - sfLatencyAvailable()
   - sfLatencyDisabledReason()
   - formatMs(value)
   - currentLatencyMs(pct)   # pct: 95 or 99
   - detailLatency(fieldName) # e.g. 'read_p95_latency_ms'
   - latencyViewLabel()
   - templateInfo, metrics
#}

<!-- Latency section wrapper for floating toolbar visibility detection -->
<div data-section="latency">

<div
    x-show="mode === 'history' && latencyView === 'sf_execution' && sfEnrichmentLowWarning()"
    class="enrichment-warning"
    style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.375rem; padding: 0.75rem 1rem; margin-bottom: 1rem; display: flex; align-items: flex-start; gap: 0.5rem;"
>
    <span style="color: #b45309; font-size: 1.1em;">⚠</span>
    <div style="font-size: 0.875rem; color: #92400e;">
        <strong>Low enrichment:</strong>
        Only <span x-text="sfEnrichmentSampleCount()?.toLocaleString() || 0"></span> of <span x-text="sfEnrichmentTotalQueries()?.toLocaleString() || 0"></span>
        queries (<span x-text="sfEnrichmentRatioPct() || 0"></span>%) were matched in Snowflake QUERY_HISTORY.
        <template x-if="sfEstimatedAvailable() && (templateInfo?.sf_estimated_p50_latency_ms || 0) > 0">
            <span>Values shown are <strong>estimated</strong> by subtracting median network overhead (<span x-text="templateInfo?.sf_enrichment_p50_overhead_ms?.toFixed(0) || '?'"></span>ms) from end-to-end times.</span>
        </template>
        <template x-if="!sfEstimatedAvailable() || (templateInfo?.sf_estimated_p50_latency_ms || 0) <= 0">
            <span>Values shown are from a <strong>biased sample</strong> (Snowflake logs slower queries preferentially at high QPS). The actual SF execution times are likely lower.</span>
        </template>
    </div>
</div>

<div class="metrics-grid">
    <div class="metric-card">
        <div class="metric-label">
            <span>QPS</span>
            <span
                class="info-icon"
                title="Throughput (QPS): completed benchmark operations per second. Live view shows 30-second rolling average for stability; history view shows overall average."
            >i</span>
        </div>
        <div class="metric-value" x-text="mode === 'history' ? formatCompact(templateInfo?.qps || 0) : formatCompact(metrics.qps_avg_30s)"></div>
        <div class="metric-change" style="display: flex; flex-direction: column; gap: 2px;">
            <template x-if="mode === 'live'">
                <span>Instant: <span x-text="formatCompact(metrics.ops_per_sec)"></span></span>
            </template>
            <template x-if="mode === 'history' && qpsTarget()">
                <span x-text="formatCompact(templateInfo?.qps || 0) + ' / ' + formatCompact(qpsTarget()) + ' target'"></span>
            </template>
            <template x-if="mode === 'live' && qpsTarget()">
                <span x-text="(qpsTargetPct() >= 100 ? '+' : '') + (qpsTargetPct() - 100).toFixed(0) + '% vs target (' + formatCompact(qpsTarget()) + ')'"></span>
            </template>
        </div>
    </div>

    <div class="metric-card" x-show="mode === 'live'">
        <div class="metric-label">
            <span>In-flight Queries</span>
            <span
                class="info-icon"
                title="Concurrency (client): number of benchmark DB operations currently in progress (connections checked out / awaiting results). Includes client/network/connector time, plus any time spent queued/blocked server-side."
            >i</span>
        </div>
        <div class="metric-value" x-text="formatCompact(metrics.in_flight)"></div>
        <div class="metric-change">Concurrent DB operations</div>
    </div>

    <!-- Hide Snowflake Running KPI for Postgres table types -->
    <div class="metric-card" x-show="mode === 'live' && !['postgres', 'snowflake_postgres'].includes((templateInfo?.table_type || '').toLowerCase())">
        <div class="metric-label">
            <span
                x-text="metrics.sf_bench_available ? 'Snowflake Running (bench)' : 'Snowflake Running'"
            ></span>
            <span
                class="info-icon"
                title="Concurrency (server): Snowflake-reported Running queries. When labeled "(bench)", it is filtered to this test via QUERY_TAG and is the most accurate 'real concurrent queries' signal."
            >i</span>
        </div>
        <div
            class="metric-value"
            x-text="formatCompact(metrics.sf_bench_available ? metrics.sf_running_bench : metrics.sf_running)"
        ></div>
        <div
            class="metric-change"
            x-text="
              formatCompact(metrics.sf_bench_available ? metrics.sf_queued_bench : metrics.sf_queued) +
              ' queued' +
              (metrics.sf_bench_available && (metrics.sf_blocked_bench || 0) > 0
                ? ' • ' + formatCompact(metrics.sf_blocked_bench) + ' blocked'
                : '')
            "
        ></div>
    </div>

    <div
        class="metrics-grid-spacer"
        x-show="mode === 'live' && !['postgres', 'snowflake_postgres'].includes((templateInfo?.table_type || '').toLowerCase())"
    ></div>

    <div class="metric-card info">
        <div class="metric-label">
            <span x-text="'P50 (Median)'"></span>
            <span
                class="info-icon"
                :title="latencyCardTitle(50)"
            >i</span>
        </div>
        <div class="metric-value-with-detail">
            <span class="metric-value-main" x-text="formatMsWithUnit(currentLatencyMs(50))"></span>
            <span class="metric-value-precise" x-text="formatMsPrecise(currentLatencyMs(50))"></span>
        </div>
        <div class="metric-change" x-text="latencyViewLabel()"></div>
    </div>

    <div class="metric-card success">
        <div class="metric-label">
            <span x-text="'P95 Latency'"></span>
            <span
                class="info-icon"
                :title="latencyCardTitle(95)"
            >i</span>
        </div>
        <div class="metric-value-with-detail">
            <span class="metric-value-main" x-text="formatMsWithUnit(currentLatencyMs(95))"></span>
            <span class="metric-value-precise" x-text="formatMsPrecise(currentLatencyMs(95))"></span>
        </div>
        <div class="metric-change" x-text="latencyViewLabel()"></div>
    </div>

    <div class="metric-card warning">
        <div class="metric-label">
            <span x-text="'P99 Latency'"></span>
            <span
                class="info-icon"
                :title="latencyCardTitle(99)"
            >i</span>
        </div>
        <div class="metric-value-with-detail">
            <span class="metric-value-main" x-text="formatMsWithUnit(currentLatencyMs(99))"></span>
            <span class="metric-value-precise" x-text="formatMsPrecise(currentLatencyMs(99))"></span>
        </div>
        <div class="metric-change" x-text="latencyViewLabel()"></div>
    </div>

    <div class="metric-card error">
        <div class="metric-label">
            <span>Error Rate</span>
            <span
                class="info-icon"
                title="Error rate: percent of operations that failed (errors / total)."
            >i</span>
        </div>
        <div class="metric-value" x-text="(metrics.error_rate || 0).toFixed(2) + '%'"></div>
        <div class="metric-change" x-text="metrics.total_errors + ' errors'"></div>
    </div>
</div>

<div class="card" x-show="mode === 'live' && isFindMaxMode()">
    <div class="card-title">Find Max (step-load) (live)</div>
    <div class="text-sm text-gray-700" style="margin-top: -0.25rem;">
        Step-load controller metrics (baseline vs current latency, upcoming worker change, and conclusion reason).
    </div>

    <div class="overflow-x-auto" style="margin-top: 0.75rem;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #f3f4f6;">
                <tr>
                    <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Step</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Established P95 (baseline)</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Current P95</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">% diff</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">P95 drift threshold</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Current P99</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">P99 drift threshold</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Error %</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb; white-space: nowrap;">Max Error %</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;" x-text="'Step ' + (findMaxState()?.current_step ?? '—')"></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMsWithUnit(findMaxBaselineP95Ms())"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(findMaxCurrentP95Ms(), findMaxP95MaxThresholdMs())"
                        x-text="formatMsWithUnit(findMaxCurrentP95Ms())"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        x-text="
                            (findMaxP95DiffPct() == null)
                                ? 'N/A'
                                : ((findMaxP95DiffPct() >= 0 ? '+' : '') + findMaxP95DiffPct().toFixed(1) + '%')
                        "
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMsWithUnit(findMaxP95MaxThresholdMs())"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(findMaxCurrentP99Ms(), findMaxP99MaxThresholdMs())"
                        x-text="formatMsWithUnit(findMaxCurrentP99Ms())"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMsWithUnit(findMaxP99MaxThresholdMs())"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(findMaxCurrentErrorPct(), findMaxMaxErrorPct(), true)"
                        x-text="formatPctValue(findMaxCurrentErrorPct())"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetPct(findMaxMaxErrorPct())"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="metrics-grid" style="margin-top: 1rem;">
        <div class="metric-card">
            <div class="metric-label">
                <span>Workers</span>
                <span class="info-icon" title="Current step concurrency target → next planned concurrency. Countdown is until the controller re-evaluates and applies the next change (end of step).">i</span>
            </div>
            <div class="metric-value"
                x-text="
                    findMaxCurrentWorkers() == null
                        ? 'N/A'
                        : (findMaxNextWorkers() == null
                            ? findMaxCurrentWorkers()
                            : (findMaxCurrentWorkers() === findMaxNextWorkers() || findMaxAtMax()
                                ? findMaxCurrentWorkers() + ' (max)'
                                : findMaxCurrentWorkers() + ' → ' + findMaxNextWorkers()))
                "
            ></div>
            <div class="metric-change" style="display: flex; flex-direction: column; gap: 2px;">
                <div x-show="findMaxActiveWorkers() != null" x-text="'Active: ' + formatInt(findMaxActiveWorkers())"></div>
                <div x-show="findMaxNextWorkers() != null" x-text="'Next change in: ' + (findMaxCountdownSeconds != null ? (findMaxCountdownSeconds + 's') : '—')"></div>
            </div>
        </div>

        <div class="metric-card" x-show="findMaxState() && findMaxState().best_concurrency != null">
            <div class="metric-label">
                <span>Best So Far</span>
                <span class="info-icon" title="Best observed stable step so far (highest QPS).">i</span>
            </div>
            <div class="metric-value" x-text="formatInt(findMaxState()?.best_concurrency)"></div>
            <div class="metric-change" x-text="formatCompact(findMaxState()?.best_qps || 0) + ' QPS'"></div>
        </div>

        <div class="metric-card" x-show="findMaxConclusionReason()">
            <div class="metric-label">
                <span>Conclusion Reason</span>
                <span class="info-icon" title="Plain-text reason for why the FIND_MAX_CONCURRENCY run stopped or completed.">i</span>
            </div>
            <div class="metric-value" style="font-size: 1rem; line-height: 1.4; white-space: pre-wrap;" x-text="findMaxConclusionReason()"></div>
            <div class="metric-change" x-text="'Status: ' + (status || '')"></div>
        </div>
    </div>
</div>

<div class="card" x-show="templateInfo" style="margin-top: 1rem;">
    <div class="card-title">Targets (SLOs)</div>
    <div class="text-sm text-gray-700" style="margin-top: -0.25rem; display: flex; align-items: center; gap: 0.5rem;">
        <div><strong>Overall:</strong></div>
        <span class="status-badge" :class="sloOverallBadgeClass()" x-text="sloOverallStatus()"></span>
        <div style="color: #6b7280;">
            (strict: all query types with non-zero weight must meet enabled targets)
        </div>
    </div>

    <div x-show="sloOverallStatus() === 'DISABLED'" style="color: #6b7280; margin-top: 0.75rem;">
        No SLO targets configured (all targets are disabled).
    </div>

    <div class="overflow-x-auto" style="margin-top: 0.75rem;" x-show="sloOverallStatus() !== 'DISABLED'">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #f3f4f6;">
                <tr>
                    <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Query Type</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Weight</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P95 (ms)</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P95 Target</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P99 (ms)</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P99 Target</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Error %</th>
                    <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Max Error %</th>
                    <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr x-show="workloadPct('POINT_LOOKUP') > 0">
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Point Lookup</td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="workloadPct('POINT_LOOKUP') + '%'"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP95Ms('POINT_LOOKUP'), sloTargetP95Ms('POINT_LOOKUP'))"
                        x-text="formatMs(sloObservedP95Ms('POINT_LOOKUP'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP95Ms('POINT_LOOKUP'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP99Ms('POINT_LOOKUP'), sloTargetP99Ms('POINT_LOOKUP'))"
                        x-text="formatMs(sloObservedP99Ms('POINT_LOOKUP'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP99Ms('POINT_LOOKUP'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedErrorPct('POINT_LOOKUP'), sloTargetErrorPct('POINT_LOOKUP'), true)"
                        x-text="formatPctValue(sloObservedErrorPct('POINT_LOOKUP'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetPct(sloTargetErrorPct('POINT_LOOKUP'))"></td>
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                        <span class="status-badge" :class="sloBadgeClass('POINT_LOOKUP')" x-text="sloRowStatus('POINT_LOOKUP')"></span>
                    </td>
                </tr>
                <tr x-show="workloadPct('RANGE_SCAN') > 0">
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Range Scan</td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="workloadPct('RANGE_SCAN') + '%'"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP95Ms('RANGE_SCAN'), sloTargetP95Ms('RANGE_SCAN'))"
                        x-text="formatMs(sloObservedP95Ms('RANGE_SCAN'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP95Ms('RANGE_SCAN'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP99Ms('RANGE_SCAN'), sloTargetP99Ms('RANGE_SCAN'))"
                        x-text="formatMs(sloObservedP99Ms('RANGE_SCAN'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP99Ms('RANGE_SCAN'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedErrorPct('RANGE_SCAN'), sloTargetErrorPct('RANGE_SCAN'), true)"
                        x-text="formatPctValue(sloObservedErrorPct('RANGE_SCAN'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetPct(sloTargetErrorPct('RANGE_SCAN'))"></td>
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                        <span class="status-badge" :class="sloBadgeClass('RANGE_SCAN')" x-text="sloRowStatus('RANGE_SCAN')"></span>
                    </td>
                </tr>
                <tr x-show="workloadPct('INSERT') > 0">
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Insert</td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="workloadPct('INSERT') + '%'"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP95Ms('INSERT'), sloTargetP95Ms('INSERT'))"
                        x-text="formatMs(sloObservedP95Ms('INSERT'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP95Ms('INSERT'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedP99Ms('INSERT'), sloTargetP99Ms('INSERT'))"
                        x-text="formatMs(sloObservedP99Ms('INSERT'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetMs(sloTargetP99Ms('INSERT'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;"
                        :class="thresholdClass(sloObservedErrorPct('INSERT'), sloTargetErrorPct('INSERT'), true)"
                        x-text="formatPctValue(sloObservedErrorPct('INSERT'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatTargetPct(sloTargetErrorPct('INSERT'))"></td>
                    <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                        <span class="status-badge" :class="sloBadgeClass('INSERT')" x-text="sloRowStatus('INSERT')"></span>
                    </td>
                </tr>
                <tr x-show="workloadPct('UPDATE') > 0">
                    <td style="padding: 0.5rem; font-weight: 500;">Update</td>
                    <td style="padding: 0.5rem; text-align: right;" x-text="workloadPct('UPDATE') + '%'"></td>
                    <td
                        style="padding: 0.5rem; text-align: right;"
                        :class="thresholdClass(sloObservedP95Ms('UPDATE'), sloTargetP95Ms('UPDATE'))"
                        x-text="formatMs(sloObservedP95Ms('UPDATE'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right;" x-text="formatTargetMs(sloTargetP95Ms('UPDATE'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right;"
                        :class="thresholdClass(sloObservedP99Ms('UPDATE'), sloTargetP99Ms('UPDATE'))"
                        x-text="formatMs(sloObservedP99Ms('UPDATE'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right;" x-text="formatTargetMs(sloTargetP99Ms('UPDATE'))"></td>
                    <td
                        style="padding: 0.5rem; text-align: right;"
                        :class="thresholdClass(sloObservedErrorPct('UPDATE'), sloTargetErrorPct('UPDATE'), true)"
                        x-text="formatPctValue(sloObservedErrorPct('UPDATE'))"
                    ></td>
                    <td style="padding: 0.5rem; text-align: right;" x-text="formatTargetPct(sloTargetErrorPct('UPDATE'))"></td>
                    <td style="padding: 0.5rem;">
                        <span class="status-badge" :class="sloBadgeClass('UPDATE')" x-text="sloRowStatus('UPDATE')"></span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div style="color: #6b7280; margin-top: 0.75rem;">
        SLO evaluation uses end-to-end (app) latency. The SQL-execution view is still available for diagnosing where time is spent.
    </div>
</div>

<div
    x-show="latencyView === 'sf_execution' && !sfLatencyAvailable()"
    class="card"
    style="margin-top: -1rem;"
>
    <div style="color: #6b7280;">
        SQL execution timings are available after processing completes (they come from
        <code>INFORMATION_SCHEMA.QUERY_HISTORY</code>).
    </div>
</div>

<div class="card" x-show="templateInfo && isFinalMetricsReady()">
    <div class="card-title">Detailed Latency Breakdown</div>
    <div style="color: #6b7280; margin-top: -0.25rem;">
        Values below reflect the selected latency view.
    </div>

    <div class="metrics-grid" style="margin-top: 1rem;">
        <div class="metric-card">
            <div class="metric-label">
                <span>Read Operations</span>
                <span
                    class="info-icon"
                    title="Read operations: total completed reads (point lookups + range scans) during this run."
                >i</span>
            </div>
            <div class="metric-value" x-text="templateInfo?.read_operations || 0"></div>
            <div class="metric-change" x-text="(templateInfo?.reads_per_second || 0).toFixed(2) + ' ops/s'"></div>
        </div>
        <div class="metric-card">
            <div class="metric-label">
                <span>Write Operations</span>
                <span
                    class="info-icon"
                    title="Write operations: total completed writes (inserts + updates) during this run."
                >i</span>
            </div>
            <div class="metric-value" x-text="templateInfo?.write_operations || 0"></div>
            <div class="metric-change" x-text="(templateInfo?.writes_per_second || 0).toFixed(2) + ' ops/s'"></div>
        </div>
    </div>

    <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 600;">Read vs Write Latency</h4>
    <table style="width: 100%; border-collapse: collapse; margin-top: 0.5rem;">
        <thead style="background: #f3f4f6;">
            <tr>
                <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Type</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;"># Queries</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P50 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P95 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P99 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Min (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Max (ms)</th>
                <th x-show="mode === 'history'" style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Data</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Reads</td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatCompact((templateInfo?.point_lookup_count || 0) + (templateInfo?.range_scan_count || 0))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('read_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('read_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('read_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('read_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('read_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('POINT_LOOKUP,RANGE_SCAN')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Writes</td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatCompact((templateInfo?.insert_count || 0) + (templateInfo?.update_count || 0))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('write_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('write_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('write_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('write_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('write_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('INSERT,UPDATE')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
        </tbody>
    </table>

    <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 600;">Per-Query-Type Latency</h4>
    <table style="width: 100%; border-collapse: collapse; margin-top: 0.5rem;">
        <thead style="background: #f3f4f6;">
            <tr>
                <th style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Query Type</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;"># Queries</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P50 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P95 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">P99 (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Min (ms)</th>
                <th style="padding: 0.5rem; text-align: right; border-bottom: 2px solid #e5e7eb;">Max (ms)</th>
                <th x-show="mode === 'history'" style="padding: 0.5rem; text-align: left; border-bottom: 2px solid #e5e7eb;">Data</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Point Lookup</td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatCompact(templateInfo?.point_lookup_count || 0)"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('point_lookup_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('point_lookup_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('point_lookup_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('point_lookup_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('point_lookup_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('POINT_LOOKUP')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Range Scan</td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatCompact(templateInfo?.range_scan_count || 0)"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('range_scan_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('range_scan_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('range_scan_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('range_scan_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('range_scan_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('RANGE_SCAN')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; font-weight: 500;">Insert</td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatCompact(templateInfo?.insert_count || 0)"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('insert_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('insert_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('insert_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('insert_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right; border-bottom: 1px solid #e5e7eb;" x-text="formatMs(detailLatency('insert_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('INSERT')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
            <tr>
                <td style="padding: 0.5rem; font-weight: 500;">Update</td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatCompact(templateInfo?.update_count || 0)"></td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatMs(detailLatency('update_p50_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatMs(detailLatency('update_p95_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatMs(detailLatency('update_p99_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatMs(detailLatency('update_min_latency_ms'))"></td>
                <td style="padding: 0.5rem; text-align: right;" x-text="formatMs(detailLatency('update_max_latency_ms'))"></td>
                <td x-show="mode === 'history'" style="padding: 0.5rem;">
                    <a
                        class="btn btn-secondary btn-sm"
                        :href="testId ? `/dashboard/history/${testId}/data?kinds=${encodeURIComponent('UPDATE')}` : '#'"
                    >
                        Go to data
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

</div><!-- end data-section="latency" wrapper -->

